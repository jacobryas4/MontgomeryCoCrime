<html>
    <head>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    </head>
    <body>

        <script>
            
                    var listOfLocalities = [];
                    var localities = [];
                    var crimes = [];
                    var citiesAndSums;

                    var Rockville = [];
                    var SilverSpring = [];
                    var Germantown = [];
                    var Gaithersburg = [];
                    //var newArr;
                    count = function (ary, classifier) {
                        classifier = classifier || String;
                        return ary.reduce(function (counter, item) {
                            var p = classifier(item);
                            counter[p] = counter.hasOwnProperty(p) ? counter[p] + 1 : 1;
                            return counter;
                        }, {})
                    };

                    d3.csv('data/CrimeUpdated.csv', function(data) 
                    {
                        for (var i = 0; i < data.length; i++) {

                            if (data[i]["Crime Name2"] !== "All Other Offenses" && data[i]["Crime Name2"] !== "NOT NIBRS CODE") {
                                if (data[i]["City "] == "ROCKVILLE") {
                                    Rockville.push(data[i]);
                                } else if (data[i]["City "] == "SILVER SPRING") {
                                    SilverSpring.push(data[i]);
                                } else if (data[i]["City "] == "GAITHERSBURG") {
                                    Gaithersburg.push(data[i]);
                                } else if (data[i]["City "] == "GERMANTOWN") {
                                    Germantown.push(data[i]);
                                }
                            }
                        }
                        
                        // create arrays of each towns crimes and totals 
                        SilverSpringCrimes = count(SilverSpring, function(item) {
                            var crime = item["Crime Name2"];
                            return crime;
                        })
                        RockvilleCrimes = count(Rockville, function(item) {
                            var crime = item["Crime Name2"];
                            return crime;
                        })
                        GermantownCrimes = count(Germantown, function(item) {
                            var crime = item["Crime Name2"];
                            return crime;
                        })
                        GaithersburgCrimes = count(Gaithersburg, function(item) {
                            var crime = item["Crime Name2"];
                            return crime;
                        })
                        
                        // sort them by crime total from greatest to least
                        Object.keys(SilverSpringCrimes).sort(function(a,b){return SilverSpringCrimes[a]-SilverSpringCrimes[b]});
                    });                    

                    function dataReady() {
                        // make bar chart
                        drawBarChart('United States');
            
                        // populate selection list
                        d3.select('#selectionWidget').selectAll('option').data(listOfLocalities).enter().append('option')
                            .html(function(d) { return d; })
                            .attr('value', function(d) { return d; })
            
                        d3.select("#selectionWidget")
                            .on('change', function() {
            
                                // clear the contents of the chart
                                d3.select("#main").selectAll('g').remove();
            
                                // figure out the newly selected locality
                                var selection = document.getElementById('selectionWidget');
                                var localityName = selection.options[selection.selectedIndex].value;
            
                                console.log('new locality: ' + localityName);
            
                                // re-draw bar chart for the new locality
                                drawBarChart(localityName);
                            });
                    }
                        
            
                    function drawBarChart(localityName)
                    {
                        // drawing code here
                    }
                    
                </script>
    </body>
</html>